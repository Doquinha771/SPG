<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SPG RetroPlayer</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Chakra+Petch:wght@500;700&family=Orbitron:wght@700&family=Inter:wght@400;700&display=swap" rel="stylesheet">
    <style>
        /* CSS Variables for a new theme */
        :root {
            --bg-color: #0d1117;
            --player-bg: #161b22;
            --display-bg: #010409;
            --display-text: #58a6ff;
            --display-shadow: #58a6ff80;
            --border-color: #30363d;
            --button-bg: #21262d;
            --button-text: #c9d1d9;
            --button-hover: #30363d;
            --accent-color: #f778ba;
            --text-color: #e6edf3;
            --album-header-bg: #1f242c;
        }

        /* Basic Reset */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
            padding: 1rem;
            overflow-x: hidden;
        }

        /* Main Player Container */
        .retro-player {
            width: 100%;
            max-width: 480px;
            background: linear-gradient(145deg, #1f242c, #161b22);
            border-radius: 16px;
            border: 1px solid var(--border-color);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.6), inset 0 1px 2px rgba(255, 255, 255, 0.05);
            padding: 1.25rem;
            display: flex;
            flex-direction: column;
            gap: 1.25rem;
            position: relative; /* For positioning special effects */
            overflow: hidden; /* Hide overflowing animations */
        }

        /* Digital Display */
        .display-container {
            background-color: var(--display-bg);
            border: 1px solid var(--border-color);
            border-radius: 10px;
            padding: 1rem;
            box-shadow: inset 0 0 15px rgba(0, 0, 0, 0.8);
            position: relative;
            min-height: 100px; /* Taller display */
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .led-display {
            font-family: 'Orbitron', sans-serif;
            font-weight: 700;
            font-size: 1.3rem;
            color: var(--display-text);
            text-shadow: 0 0 8px var(--display-shadow), 0 0 12px var(--display-shadow);
            text-align: center;
            line-height: 1.4;
            width: 100%;
            z-index: 2;
        }
        
        /* Sound Wave Visualizer */
        #visualizer {
            display: flex;
            justify-content: center;
            align-items: flex-end;
            height: 30px;
            gap: 4px;
            position: absolute;
            bottom: 10px;
            left: 50%;
            transform: translateX(-50%);
            opacity: 0;
            transition: opacity 0.5s ease-out;
            z-index: 1;
        }

        #visualizer.active {
            opacity: 0.6;
        }

        .bar {
            width: 6px;
            background: linear-gradient(to top, var(--display-text), var(--accent-color));
            border-radius: 2px;
            height: 100%;
            transform-origin: bottom;
        }
        
        #visualizer.active .bar:nth-child(1) { animation: sound-wave 1.3s infinite ease-in-out alternate; }
        #visualizer.active .bar:nth-child(2) { animation: sound-wave 1.1s infinite ease-in-out alternate .2s; }
        #visualizer.active .bar:nth-child(3) { animation: sound-wave 1.5s infinite ease-in-out alternate .1s; }
        #visualizer.active .bar:nth-child(4) { animation: sound-wave 1.2s infinite ease-in-out alternate .3s; }
        #visualizer.active .bar:nth-child(5) { animation: sound-wave 1.4s infinite ease-in-out alternate .2s; }

        @keyframes sound-wave {
            from { transform: scaleY(0.1); }
            to { transform: scaleY(1); }
        }

        /* Controls */
        .controls {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 0.75rem;
        }

        .btn-retro {
            font-family: 'Inter', sans-serif;
            font-size: 1.5rem;
            background: linear-gradient(145deg, #2a2f37, #21262d);
            color: var(--button-text);
            border: 1px solid var(--border-color);
            border-radius: 50%; /* Circular buttons */
            width: 60px;
            height: 60px;
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: 0 5px 10px rgba(0,0,0,0.3), inset 0 1px 1px rgba(255,255,255,0.05);
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 0 auto;
        }

        .btn-retro:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 15px rgba(0,0,0,0.4);
        }

        .btn-retro:active, .btn-retro.active {
            transform: translateY(1px);
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
            background: var(--accent-color);
            color: white;
            border-color: #ffaddb;
        }

        /* Playlist / Album List */
        .playlist {
            background-color: var(--player-bg);
            border: 1px solid var(--border-color);
            border-radius: 10px;
            padding: 0.5rem;
            max-height: 50vh;
            overflow-y: auto;
        }
        
        .album-header {
            background-color: var(--album-header-bg);
            padding: 0.85rem 1rem;
            margin-bottom: 0.25rem;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            transition: background-color 0.2s;
            border: 1px solid transparent;
        }
        
        .album-header:hover {
            background-color: var(--button-hover);
        }
        
        .album-header.playing {
            color: var(--accent-color);
            border-color: var(--accent-color);
        }

        .track-list {
            display: none;
            padding-left: 1rem;
            overflow: hidden;
            border-left: 2px solid var(--border-color);
            margin-left: 1rem;
            margin-top: 0.5rem;
        }
        
        .album.open .track-list {
            display: block;
        }

        .track {
            padding: 0.75rem 0.5rem;
            border-bottom: 1px solid var(--border-color);
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            transition: background-color 0.2s, color 0.2s;
        }

        .track:last-child {
            border-bottom: none;
        }

        .track:hover {
            background-color: var(--button-hover);
        }

        .track.playing {
            color: var(--display-text);
            font-weight: bold;
        }
        
        .hidden-player {
            position: absolute;
            top: -9999px;
            left: -9999px;
        }
        
        /* Peace Doves Animation */
        #peace-doves-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 10;
            display: none; /* Hidden by default */
        }
        
        .dove {
            position: absolute;
            font-size: 2rem;
            opacity: 0;
            animation: fly-across linear infinite;
        }
        
        @keyframes fly-across {
            0% {
                transform: translateX(-100px) scale(0.8);
                opacity: 0;
            }
            10% {
                opacity: 0.7;
            }
            90% {
                opacity: 0.7;
            }
            100% {
                transform: translateX(480px) scale(1.2);
                opacity: 0;
            }
        }

        /* Responsive Design */
        @media (max-width: 600px) {
            body {
                padding: 0.5rem;
            }
            .retro-player {
                padding: 1rem;
            }
            .led-display {
                font-size: 1.1rem;
            }
            .btn-retro {
                width: 50px;
                height: 50px;
                font-size: 1.25rem;
            }
        }
    </style>
</head>
<body>

    <div class="retro-player">
        <div id="peace-doves-container"></div>

        <div class="display-container">
            <div id="led-display" class="led-display">üîä SPG RetroPlayer</div>
            <div id="visualizer">
                <div class="bar"></div>
                <div class="bar"></div>
                <div class="bar"></div>
                <div class="bar"></div>
                <div class="bar"></div>
            </div>
        </div>

        <div class="controls">
            <button id="prev-btn" class="btn-retro">‚èÆÔ∏è</button>
            <button id="play-pause-btn" class="btn-retro">‚ñ∂Ô∏è</button>
            <button id="next-btn" class="btn-retro">‚è≠Ô∏è</button>
            <button id="shuffle-btn" class="btn-retro">üîÄ</button>
            <button id="repeat-btn" class="btn-retro">üîÅ</button>
        </div>

        <div id="playlist" class="playlist">
            <!-- Albums and tracks will be generated by JavaScript -->
        </div>
    </div>

    <!-- Hidden div for the YouTube player -->
    <div id="youtube-player" class="hidden-player"></div>
    
    <script src="https://www.youtube.com/iframe_api"></script>
    <script>
        // --- DATA ---
        const albums = [
             {
                name: "SPG Hyperpop",
                tracks: [
                    { title: "FUNNY POOP SUPER COOL", videoId: "e-mhqxO_2pU" },
                    { title: "O ALQUIMISTA", videoId: "PnhzLdwUH1A" },
                    { title: "SCOOBY-POO", videoId: "DuGvCZ6UkuU" },
                    { title: "HOMUNCULUS", videoId: "C5fUIVT-6A4" },
                    { title: "DONA DE CASA", videoId: "guVnNGaNWsg" },
                    { title: "KARAGUEI", videoId: "ctQWkjVsPjk" },
                    { title: "O BURACO PERFEITO", videoId: "l3rQBbq8qAM" },
                    { title: "BOCA DE PELO", videoId: "zctEa4nKy1k" },
                    { title: "ATIRADORES", videoId: "h4JOLbUXc1c" },
                    { title: "FLATUL√äNCIA E VIOL√äNCIA", videoId: "4ZOxdkB8hmQ" },
                ]
            },
            {
                name: "SPG VOLUME 2: BEM VINDO AO NOSSO MUNDO",
                tracks: [
                    { title: "MEGA 50135", videoId: "ptuTUNGxVng" },
                    { title: "TA LIGADO", videoId: "E9PGNRcbx-o" },
                    { title: "JACK & MIKE", videoId: "JBMc9Qzf4qk" },
                    { title: "PINTORTO", videoId: "KhLuIXq1kU8" },
                    { title: "HOSPITAL S.A.", videoId: "eS67IEuVbt0" },
                    { title: "00SEXY O ESPI√ÉO QUE MAMAVA", videoId: "6lAQsoODku4" },
                    { title: "SIMSALABIM", videoId: "3qfJwo9KLwA" },
                    { title: "FAKE NEWS", videoId: "1DHE-SfgL2k" },
                    { title: "FELIZ DEMAIS", videoId: "3D16RakxZ2g" },
                    { title: "MARCHA FUNEBRE II", videoId: "7m4URsajm6o" },
                ]
            },
            {
                name: "SPG 3 - SUJOS E INDELICADOS",
                tracks: [
                    { title: "MIJA (NO TEU HOME)", videoId: "hPXLTgkHdt0" },
                    { title: "XXT MEGA IRADA", videoId: "LF0GO0PR3sA" },
                    { title: "ALIMENTASSON PLAY√á√ÉO", videoId: "fZFlxlEF75E" },
                    { title: "PLAYSSON'S MANDAMENTOWS", videoId: "x_raUwMXHng" },
                ]
            },
            {
                name: "SPG - S√≥ mais um solst√≠cio em cap√£o da canoa pt II",
                tracks: [
                    { title: "UMA CARTA PARA ISABEL", videoId: "YdWljCcqESE" },
                    { title: "CR√àME BR√õL√âE E OUTRAS RECEITAS", videoId: "537pE9qYzK0" },
                    { title: "2001 COISAS QUE ODEIO EM VOC√ä", videoId: "7WsJNjk2dk0" },
                    { title: "TIPOS DE CARINHA (DEPRESS√ÉO)", videoId: "HXPbLrwdeKw" },
                ]
            },
            {
                name: "Palha√ßo Corp - Mil e uma noites no circo",
                tracks: [
                    { title: "2 - AQUEDUCTO", videoId: "sxWIBik_RBE" },
                    { title: "9 - CARRO PALHA√áO", videoId: "_lCrruEPjcs" },
                    { title: "1 - PALHA√áO CORP INC", videoId: "m5hie6qVh5w" },
                    { title: "3 - PSICOPALHA√áADA", videoId: "D-xoIrp4_Y" },
                    { title: "4 - FREAKSHOW TOTAL", videoId: "DxY2ylfUnGs" },
                    { title: "5 - VEM VIAJAR", videoId: "AeyiHt3QKxw" },
                    { title: "6 - DROGAS DO X4NAX", videoId: "vsioOs-xeVc" },
                    { title: "7 - LOVE ARLEQUINAS", videoId: "AF7P3MwjI1k" },
                    { title: "8 - BIP BOP", videoId: "3LNP_LaJIKI" },
                    { title: "10 - DISS PRO TONY KILL", videoId: "2pJw49JMNB0" },
                ]
            },
            {
                name: "SPG - O CIRCO VAI PEGA FOGO",
                tracks: [
                    { title: "O CIRCO VAI PEGA FOGO", videoId: "OQlxvSLEiHY" },
                ]
            },
            {
                name: "Bhor Habill e os 40 avi√µes",
                tracks: [
                    { title: "Bhor Habill e os 40 avi√µes", videoId: "qF2UFBk8ON8" },
                ]
            },
            {
                name: "SPG IV - CONTRATO DE SANGUE",
                tracks: [
                    { title: "FREAKY FREAKY FRIDAYS", videoId: "OC2t-dL9jrU" },
                    { title: "ONOMATOPEIAS", videoId: "KdSyakvDBcw" },
                    { title: "DE TR√ÅS DAS BARRAS FT GERSON SANCHEZ", videoId: "e5eER0mib9M" },
                    { title: "ABOMINAVEL HOMEM DAS FEZES", videoId: "f3Q2P6NQXao" },
                    { title: "SIGNOS", videoId: "Yo3z6hKpGeA" },
                    { title: "ECTOPLASMA", videoId: "bc3qbuRQXIg" },
                    { title: "TORANDO TUDO", videoId: "AmsCCpU8kho" },
                    { title: "ODALISCA ESCANDALOSA FT BHOR HABILL", videoId: "MuSAYaEM9dw" },
                    { title: "NUNCA CONFIE EM NENHUMA GRAVADORA", videoId: "epIBlaaDkKU" },
                    { title: "YOU AND I(SABEL)", videoId: "HHHjcRRYEIo" },
                ]
            },
            {
                name: "SPG em: VIAGENS NA GAVETINHA",
                tracks: [
                    { title: "GAVETA M√ÅGICA", videoId: "PRLe8R8tFgw" },
                    { title: "DE NOVO", videoId: "zkU-GtgCxaw" },
                    { title: "HOMEM AREIA", videoId: "UFjCI-9DScA" },
                    { title: "FAL√ÅCIA DO ESPANTALHO", videoId: "AUKn-SqaSrk" },
                    { title: "INSPETOR", videoId: "Tg00mpXEqI0" },
                    { title: "PODEROSO CHEF√ÉO", videoId: "AHwLXXyR_Is" },
                    { title: "MURALHA DA MARAVILHA", videoId: "6aj51RWlqpA" },
                    { title: "O TESTE (FRESSTYLE DE SCHRODINGER)", videoId: "YwxQHJ2dCLE" },
                    { title: "SPGL√ÇNDIA", videoId: "PiVBfDPxK6Y" },
                    { title: "bAd Trip", videoId: "BEG9pROL56Q" },
                ]
            },
            {
                name: "Spg s√≥ mais um solst√≠cio em cap√£o da canoa pt I",
                tracks: [
                    { title: "MULHERES REAIS", videoId: "eTaVooqjdRI" },
                    { title: "BANHO SINUCA", videoId: "-M795H9-NEM" },
                    { title: "BOTECO DO GERSIN", videoId: "VejOXuC27zM" },
                    { title: "FAHRENHEIT 9 -11", videoId: "dnKekTRuCIc" },
                    { title: "ANOS 90", videoId: "QF3E5E3Rmd8" },
                ]
            },
            {
                name: "SPG & BHOR HABILL - BAGUNCINHAS NO MEDITERRANEO",
                tracks: [
                    { title: "AMIGOS EXPLOSIVOS", videoId: "6XBoYdpHZ4M" },
                    { title: "SUPER SHEIK", videoId: "Zop8ZeerqQs" },
                    { title: "ESPELUNCA", videoId: "oICK0so7qC4" },
                    { title: "VELOZES E ARENOSOS", videoId: "tiIozXYLVeo" },
                    { title: "RIO DE SANGUE", videoId: "9EGazx23sAk" },
                    { title: "UMA NOITE MUITO LOUCA", videoId: "6A2x0R8JCKI" },
                    { title: "CASEM COMIGO", videoId: "iNSwUYWxU-E" },
                    { title: "EXPLOS√ÉO MALUCA GRANDIOSA", videoId: "6wMhClETCOY" },
                    { title: "FACHADA AR√ÅBICA", videoId: "EiodQh1fLBg" },
                    { title: "ME DEIXE IR (EXPLODIR)", videoId: "4QARbSUMA4E" },
                ]
            },
            {
                name: "SPG - Gabriel pinto da silva (rip)",
                tracks: [
                    { title: "Gabriel pinto da silva (rip)", videoId: "d9oDxb3YJpM" },
                ]
            },
            {
                name: "SPG - O SEGREDO DA FELICIDADE",
                tracks: [
                    { title: "ASSASSINATOS", videoId: "sGWljyo4Zv0" },
                    { title: "BANHO DE MAR", videoId: "2SQttjoLQ0E" },
                    { title: "JOGO DO BICHO", videoId: "KNXJe2RxB_o" },
                    { title: "GRATID√ÉO", videoId: "Ch6N32C5WPA" },
                    { title: "MINHA PRIMA", videoId: "3mYcFadJBR8" },
                    { title: "PIZZA E OUTRAS MASSAS", videoId: "pcBeu4gp0zg" },
                    { title: "MERDAS SINCERAS", videoId: "zYVq-dqagXM" },
                    { title: "ESPECIAL (PRA MIM)", videoId: "jlZir3kxqdc" },
                    { title: "FACULDADE DA VIDA (ME FORMEI EM MEDICINA)", videoId: "b0E2nFZnekk" },
                    { title: "PAZ MUNDIAL", videoId: "f6K732snn8g" },
                ]
            },
            {
                name: "SPG - PAZ MUNDIAL (TOUR 2012)",
                tracks: [
                    { title: "PAZ MUNDIAL (LIVE)", videoId: "xuYT24voy6A" },
                ]
            }
        ];

        // --- STATE ---
        let player;
        let currentAlbumIndex = -1;
        let currentTrackIndex = -1;
        let isShuffle = false;
        let repeatMode = 0; // 0: no repeat, 1: repeat all, 2: repeat one
        let flatPlaylist = [];

        // --- DOM ELEMENTS ---
        const display = document.getElementById('led-display');
        const playlistContainer = document.getElementById('playlist');
        const playPauseBtn = document.getElementById('play-pause-btn');
        const nextBtn = document.getElementById('next-btn');
        const prevBtn = document.getElementById('prev-btn');
        const shuffleBtn = document.getElementById('shuffle-btn');
        const repeatBtn = document.getElementById('repeat-btn');
        const visualizer = document.getElementById('visualizer');
        const dovesContainer = document.getElementById('peace-doves-container');

        // --- YOUTUBE PLAYER API ---
        function onYouTubeIframeAPIReady() {
            player = new YT.Player('youtube-player', {
                height: '0',
                width: '0',
                playerVars: { 'playsinline': 1, 'autoplay': 0, 'controls': 0 },
                events: { 'onReady': onPlayerReady, 'onStateChange': onPlayerStateChange }
            });
        }

        function onPlayerReady(event) {
            console.log("Player is ready.");
            display.textContent = "Toque em uma m√∫sica";
        }

        function onPlayerStateChange(event) {
            if (event.data === YT.PlayerState.PLAYING) {
                playPauseBtn.innerHTML = '‚è∏Ô∏è';
                const track = albums[currentAlbumIndex].tracks[currentTrackIndex];
                display.textContent = `${track.title}`;
                visualizer.classList.add('active');
                updatePlayingStyles();
            } else {
                playPauseBtn.innerHTML = '‚ñ∂Ô∏è';
                visualizer.classList.remove('active');
            }

            if (event.data === YT.PlayerState.ENDED) {
                playNext();
            }
        }

        // --- UI & PLAYLIST LOGIC ---
        function generatePlaylist() {
            playlistContainer.innerHTML = '';
            albums.forEach((album, albumIdx) => {
                const albumDiv = document.createElement('div');
                albumDiv.className = 'album';
                albumDiv.dataset.albumIndex = albumIdx;

                const albumHeader = document.createElement('div');
                albumHeader.className = 'album-header';
                albumHeader.innerHTML = `üìÅ ${album.name}`;
                albumHeader.onclick = () => toggleAlbum(albumDiv);
                
                const trackList = document.createElement('div');
                trackList.className = 'track-list';

                album.tracks.forEach((track, trackIdx) => {
                    const trackDiv = document.createElement('div');
                    trackDiv.className = 'track';
                    trackDiv.dataset.albumIndex = albumIdx;
                    trackDiv.dataset.trackIndex = trackIdx;
                    trackDiv.innerHTML = `üéµ ${track.title}`;
                    trackDiv.onclick = () => playTrack(albumIdx, trackIdx);
                    trackList.appendChild(trackDiv);
                });

                albumDiv.appendChild(albumHeader);
                albumDiv.appendChild(trackList);
                playlistContainer.appendChild(albumDiv);
            });
            
            flatPlaylist = albums.flatMap((album, albumIdx) => 
                album.tracks.map((track, trackIdx) => ({...track, albumIdx, trackIdx}))
            );
        }
        
        function toggleAlbum(albumDiv) {
            albumDiv.classList.toggle('open');
        }

        function updatePlayingStyles() {
            document.querySelectorAll('.track.playing, .album-header.playing').forEach(el => {
                el.classList.remove('playing');
            });

            if (currentAlbumIndex > -1 && currentTrackIndex > -1) {
                const currentTrackEl = document.querySelector(`.track[data-album-index='${currentAlbumIndex}'][data-track-index='${currentTrackIndex}']`);
                if (currentTrackEl) {
                    currentTrackEl.classList.add('playing');
                    const albumHeaderEl = currentTrackEl.closest('.album').querySelector('.album-header');
                    if(albumHeaderEl) albumHeaderEl.classList.add('playing');
                }
            }
        }
        
        // --- SPECIAL EFFECTS ---
        function handleSpecialEffects(albumName) {
            const peaceAlbums = ["SPG - O SEGREDO DA FELICIDADE", "SPG - PAZ MUNDIAL (TOUR 2012)"];
            if (peaceAlbums.includes(albumName)) {
                dovesContainer.innerHTML = ''; // Clear previous doves
                for (let i = 0; i < 5; i++) {
                    const dove = document.createElement('div');
                    dove.className = 'dove';
                    dove.innerHTML = 'üïäÔ∏è';
                    dove.style.top = `${Math.random() * 60 + 10}%`;
                    dove.style.animationDuration = `${Math.random() * 5 + 8}s`; // 8-13s
                    dove.style.animationDelay = `${Math.random() * 7}s`; // 0-7s
                    dovesContainer.appendChild(dove);
                }
                dovesContainer.style.display = 'block';
            } else {
                dovesContainer.style.display = 'none';
                dovesContainer.innerHTML = '';
            }
        }

        // --- PLAYER CONTROLS ---
        function playTrack(albumIdx, trackIdx) {
            currentAlbumIndex = albumIdx;
            currentTrackIndex = trackIdx;
            const album = albums[albumIdx];
            const track = album.tracks[trackIdx];
            
            player.loadVideoById(track.videoId);
            display.textContent = `... ${track.title}`;
            
            handleSpecialEffects(album.name);
        }

        function togglePlayPause() {
            if (!player || typeof player.getPlayerState !== 'function' || currentTrackIndex === -1) return;
            const playerState = player.getPlayerState();
            if (playerState === YT.PlayerState.PLAYING) {
                player.pauseVideo();
            } else {
                player.playVideo();
            }
        }

        function playNext() {
            if (repeatMode === 2) {
                player.seekTo(0);
                player.playVideo();
                return;
            }

            if (isShuffle) {
                const randomIndex = Math.floor(Math.random() * flatPlaylist.length);
                const randomTrack = flatPlaylist[randomIndex];
                playTrack(randomTrack.albumIdx, randomTrack.trackIdx);
                return;
            }

            let nextTrackIndex = currentTrackIndex + 1;
            let nextAlbumIndex = currentAlbumIndex;

            if (nextTrackIndex >= albums[nextAlbumIndex].tracks.length) {
                nextTrackIndex = 0;
                nextAlbumIndex++;
                if (nextAlbumIndex >= albums.length) {
                    if (repeatMode === 1) {
                       nextAlbumIndex = 0;
                    } else {
                       display.textContent = "Fim da lista";
                       handleSpecialEffects(''); // Clear effects
                       return;
                    }
                }
            }
            playTrack(nextAlbumIndex, nextTrackIndex);
        }
        
        function playPrev() {
            if (isShuffle) {
                playNext();
                return;
            }

            let prevTrackIndex = currentTrackIndex - 1;
            let prevAlbumIndex = currentAlbumIndex;

            if (prevTrackIndex < 0) {
                prevAlbumIndex--;
                if (prevAlbumIndex < 0) {
                    prevAlbumIndex = albums.length - 1;
                }
                prevTrackIndex = albums[prevAlbumIndex].tracks.length - 1;
            }
            playTrack(prevAlbumIndex, prevTrackIndex);
        }

        function toggleShuffle() {
            isShuffle = !isShuffle;
            shuffleBtn.classList.toggle('active', isShuffle);
            display.textContent = isShuffle ? "Shuffle Ativado" : "Shuffle Desativado";
        }
        
        function toggleRepeat() {
            repeatMode = (repeatMode + 1) % 3;
            let modeText = "Repetir Desativado";
            let icon = "üîÅ";
            if (repeatMode === 1) {
                modeText = "Repetir Tudo";
                repeatBtn.classList.add('active');
            } else if (repeatMode === 2) {
                modeText = "Repetir M√∫sica";
                icon = "üîÇ";
                repeatBtn.classList.add('active');
            } else {
                repeatBtn.classList.remove('active');
            }
            repeatBtn.textContent = icon;
            display.textContent = modeText;
        }

        // --- INITIALIZATION ---
        document.addEventListener('DOMContentLoaded', () => {
            generatePlaylist();
            playPauseBtn.addEventListener('click', togglePlayPause);
            nextBtn.addEventListener('click', playNext);
            prevBtn.addEventListener('click', playPrev);
            shuffleBtn.addEventListener('click', toggleShuffle);
            repeatBtn.addEventListener('click', toggleRepeat);
        });
    </script>
</body>
</html>
