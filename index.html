<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>SPG MP3 Player</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Pixelify+Sans:wght@400;700&family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-main: #1a1a1d;
            --mp3-body: #e1e1e1;
            --mp3-shadow: #c1c1c1;
            --screen-bg: #a8b8a0;
            --screen-border: #8c9c84;
            --screen-text: #2c3528;
            --wheel-color: #f0f0f0;
            --accent-playing: #2c3528;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            user-select: none;
            -webkit-user-select: none;
            -webkit-touch-callout: none;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-main);
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            overflow: hidden;
        }

        .app-wrapper {
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        #headphones {
            position: absolute;
            width: 400px;
            height: auto;
            left: -150px;
            top: 50%;
            transform: translateY(-50%) rotate(-15deg);
            z-index: 1;
            pointer-events: none;
            opacity: 0.7;
            filter: drop-shadow(5px 5px 10px #000);
        }

        /* --- MP3 PLAYER BODY --- */
        .mp3-player {
            width: 320px;
            height: 550px;
            background: linear-gradient(145deg, #f0f0f0, #c8c8c8);
            border-radius: 40px;
            box-shadow: 20px 20px 60px #111, -20px -20px 60px #333;
            padding: 25px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
            position: relative;
            z-index: 2;
        }

        /* --- SCREEN --- */
        .screen-container {
            width: 100%;
            height: 180px;
            background: #444;
            border-radius: 10px;
            padding: 8px;
            box-shadow: inset 5px 5px 10px #3a3a3a, inset -5px -5px 10px #4e4e4e;
        }
        .screen {
            width: 100%;
            height: 100%;
            background: var(--screen-bg);
            border: 4px solid var(--screen-border);
            border-radius: 4px;
            padding: 10px;
            font-family: 'Pixelify Sans', sans-serif;
            color: var(--screen-text);
            overflow: hidden;
            position: relative;
        }
        .screen-view {
            display: none;
            height: 100%;
        }
        .screen-view.active {
            display: block;
        }
        .screen-header {
            text-align: center;
            font-weight: 700;
            margin-bottom: 5px;
            border-bottom: 2px solid var(--screen-text);
        }
        .menu-list {
            list-style: none;
            height: calc(100% - 25px);
            overflow: hidden;
        }
        .menu-item {
            padding: 2px 0;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .menu-item.active {
            background-color: var(--screen-text);
            color: var(--screen-bg);
        }
        .menu-item.playing::before {
            content: '‚ñ∫';
            margin-right: 5px;
        }

        /* --- CONTROLS --- */
        .controls-container {
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
        }
        #track-info-display {
            width: 100%;
            text-align: center;
            background: #ddd;
            padding: 5px;
            border-radius: 5px;
            box-shadow: inset 2px 2px 4px #bbb, inset -2px -2px 4px #fff;
        }
        #track-title { font-weight: 700; color: #333; }
        #track-artist { font-size: 0.8rem; color: #555; }
        #time-display { font-size: 0.8rem; color: #555; }

        .click-wheel {
            width: 200px;
            height: 200px;
            border-radius: 50%;
            background: linear-gradient(145deg, #f0f0f0, #cacaca);
            box-shadow: 10px 10px 20px #b9b9b9, -10px -10px 20px #ffffff;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
            cursor: pointer;
        }
        .center-button {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: linear-gradient(145deg, #cacaca, #f0f0f0);
            border: none;
            box-shadow: 5px 5px 10px #b9b9b9, -5px -5px 10px #ffffff;
            cursor: pointer;
        }
        .center-button:active {
            box-shadow: inset 5px 5px 10px #b9b9b9, inset -5px -5px 10px #ffffff;
        }
        .wheel-icon {
            position: absolute;
            color: #888;
            font-size: 0.8rem;
            font-weight: 600;
            pointer-events: none;
        }
        .wheel-icon.menu { top: 15px; }
        .wheel-icon.next { right: 15px; }
        .wheel-icon.prev { left: 15px; }
        .wheel-icon.play-pause-wheel { bottom: 15px; }
        
        /* --- Special Effects --- */
        .screen-effect {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s;
        }
        .screen-effect.active {
            opacity: 1;
        }

        #body-blood-effect {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background-image: url('https://www.transparentpng.com/thumb/blood/blood-stain-splatter-png-pictures-3.png');
            background-size: 150%;
            background-position: 20% 20%;
            background-repeat: no-repeat;
            pointer-events: none;
            border-radius: 40px;
            opacity: 0;
            transition: opacity 0.5s ease-in-out;
        }
        #body-blood-effect.active {
            opacity: 0.7;
        }

        #bicho-glitch, #dove-glitch {
            overflow: hidden;
        }
        .pixel-sprite {
            position: absolute;
            font-size: 2rem;
            animation: scroll-across 10s linear infinite;
        }
        @keyframes scroll-across {
            from { transform: translateX(-100%); }
            to { transform: translateX(260px); }
        }
        #dove-glitch .pixel-sprite { animation-duration: 8s; }

        #youtube-player { position: absolute; top: -9999px; left: -9999px; }
        
        @media (max-width: 480px) {
            #headphones { display: none; }
            .mp3-player {
                width: 95vw;
                height: 85vh;
                max-height: 600px;
            }
        }

    </style>
</head>
<body>
    <div class="app-wrapper">
        <img id="headphones" src="https://www.pngkey.com/png/full/9-97483_headphones-png-image-free-download-auriculares-png-sin.png" alt="Fones de ouvido">
        <div class="mp3-player">
            <div id="body-blood-effect"></div>
            <div class="screen-container">
                <div class="screen">
                    <!-- Album View -->
                    <div id="album-view" class="screen-view">
                        <div class="screen-header">√Ålbuns</div>
                        <ul class="menu-list" id="album-list"></ul>
                    </div>
                    <!-- Track View -->
                    <div id="track-view" class="screen-view">
                        <div class="screen-header" id="track-list-header">M√∫sicas</div>
                        <ul class="menu-list" id="track-list"></ul>
                    </div>
                    <!-- Now Playing View -->
                    <div id="now-playing-view" class="screen-view">
                         <div id="dove-glitch" class="screen-effect">
                            <span class="pixel-sprite" style="top: 15%; animation-delay: 0s;">üïäÔ∏è</span>
                            <span class="pixel-sprite" style="top: 60%; animation-delay: 3s;">üïäÔ∏è</span>
                            <span class="pixel-sprite" style="top: 35%; animation-delay: 6s;">üïäÔ∏è</span>
                         </div>
                         <div id="bicho-glitch" class="screen-effect">
                            <span class="pixel-sprite" style="top: 20%; animation-delay: 0s;">üêò</span>
                            <span class="pixel-sprite" style="top: 50%; animation-delay: 2s;">üêì</span>
                            <span class="pixel-sprite" style="top: 30%; animation-delay: 5s;">üêÖ</span>
                         </div>
                    </div>
                </div>
            </div>
            <div class="controls-container">
                <div id="track-info-display">
                    <div id="track-title">Bem-vindo</div>
                    <div id="track-artist">Navegue com a roda</div>
                    <div id="time-display">0:00 / 0:00</div>
                </div>
                <div class="click-wheel" id="click-wheel">
                    <div class="wheel-icon menu" id="menu-btn">MENU</div>
                    <div class="wheel-icon next" id="next-btn-wheel">‚ñ∫‚ñ∫</div>
                    <div class="wheel-icon prev" id="prev-btn-wheel">‚óÑ‚óÑ</div>
                    <div class="wheel-icon play-pause-wheel">‚ñ∫/‚ùö‚ùö</div>
                    <button class="center-button" id="play-pause-btn"></button>
                </div>
            </div>
        </div>
    </div>

    <audio id="audio-player" crossorigin="anonymous"></audio>
    <div id="youtube-player"></div>

    <script src="https://www.youtube.com/iframe_api"></script>
    <script>
        const albums = [
            {
                artist: "SPG",
                title: "O Segredo da Felicidade",
                tracks: [
                    { title: "Jogo do Bicho", youtubeId: "KNXJe2RxB_o", specialEffect: "bicho" },
                    { title: "Assassinatos", youtubeId: "sGWljyo4Zv0", specialEffect: "blood" },
                ]
            },
            {
                artist: "Artista Exemplo",
                title: "Exemplos de √Åudio",
                tracks: [
                    { title: "SoundHelix Song 1", url: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3" },
                    { title: "SoundHelix Song 2", url: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-2.mp3" },
                ]
            },
        ];

        const dom = {
            albumView: document.getElementById('album-view'),
            trackView: document.getElementById('track-view'),
            nowPlayingView: document.getElementById('now-playing-view'),
            albumList: document.getElementById('album-list'),
            trackList: document.getElementById('track-list'),
            trackListHeader: document.getElementById('track-list-header'),
            trackTitle: document.getElementById('track-title'),
            trackArtist: document.getElementById('track-artist'),
            timeDisplay: document.getElementById('time-display'),
            playPauseBtn: document.getElementById('play-pause-btn'),
            clickWheel: document.getElementById('click-wheel'),
            menuBtn: document.getElementById('menu-btn'),
            nextBtn: document.getElementById('next-btn-wheel'),
            prevBtn: document.getElementById('prev-btn-wheel'),
            audioPlayer: document.getElementById('audio-player'),
            bodyBloodEffect: document.getElementById('body-blood-effect'),
            bichoGlitch: document.getElementById('bicho-glitch'),
            doveGlitch: document.getElementById('dove-glitch'),
        };

        let ytPlayer, isYtReady = false, pendingTrack = null;
        let allTracks = [], currentTrackIndex = -1, isPlaying = false, activePlayerType = null, progressInterval;
        let currentView = 'albums', selectedAlbumIndex = 0, selectedTrackIndex = 0;

        window.onYouTubeIframeAPIReady = () => {
            ytPlayer = new YT.Player('youtube-player', {
                height: '0', width: '0',
                playerVars: { 'controls': 0, 'disablekb': 1, 'playsinline': 1 },
                events: { 'onReady': onPlayerReady, 'onStateChange': onPlayerStateChange }
            });
        };
        
        function onPlayerReady() {
            isYtReady = true;
            if (pendingTrack) {
                loadTrack(pendingTrack);
                pendingTrack = null;
            }
        }

        function onPlayerStateChange(event) {
            if (event.data === YT.PlayerState.CUED) event.target.playVideo();
            if (event.data === YT.PlayerState.PLAYING) setPlayState(true);
            else if (event.data === YT.PlayerState.PAUSED || event.data === YT.PlayerState.ENDED) setPlayState(false);
            if (event.data === YT.PlayerState.ENDED) playNext();
        }

        function flattenTracks() {
            allTracks = albums.flatMap((album, albumIndex) => 
                album.tracks.map((track, trackIndex) => ({ 
                    ...track, 
                    artist: album.artist, 
                    albumTitle: album.title,
                    albumIndex,
                    originalTrackIndex: trackIndex
                }))
            );
        }

        function loadTrack(trackIndex) {
            const track = allTracks[trackIndex];
            if (!track) return;
            
            if (track.youtubeId && !isYtReady) {
                pendingTrack = trackIndex;
                dom.trackTitle.textContent = "Carregando...";
                return;
            }

            currentTrackIndex = trackIndex;
            stopAllPlayers();
            updatePlayerUI();

            if (track.youtubeId) {
                activePlayerType = 'youtube';
                ytPlayer.cueVideoById({ videoId: track.youtubeId });
            } else if (track.url) {
                activePlayerType = 'audio';
                dom.audioPlayer.src = track.url;
            }
        }

        function setPlayState(playing) {
            if (isPlaying === playing) return;
            isPlaying = playing;
            updateSpecialEffects(playing);
            renderScreen();
            if (playing) {
                if (activePlayerType === 'audio') dom.audioPlayer.play().catch(e => console.error(e));
                progressInterval = setInterval(updateProgress, 500);
            } else {
                if (activePlayerType === 'audio') dom.audioPlayer.pause();
                clearInterval(progressInterval);
            }
        }
        
        function updateSpecialEffects(playing) {
            dom.bodyBloodEffect.classList.remove('active');
            dom.bichoGlitch.classList.remove('active');
            dom.doveGlitch.classList.remove('active');

            if (playing && currentTrackIndex > -1) {
                const currentTrack = allTracks[currentTrackIndex];
                if (currentTrack.albumTitle === 'O Segredo da Felicidade') {
                    dom.doveGlitch.classList.add('active');
                }
                if (currentTrack.specialEffect === 'blood') {
                    dom.bodyBloodEffect.classList.add('active');
                }
                if (currentTrack.specialEffect === 'bicho') {
                    dom.bichoGlitch.classList.add('active');
                }
            }
        }

        function handleCenterButtonClick() {
            if (currentView === 'albums') {
                currentView = 'tracks';
                selectedTrackIndex = 0;
            } else if (currentView === 'tracks') {
                const globalIndex = allTracks.findIndex(t => t.albumIndex === selectedAlbumIndex && t.originalTrackIndex === selectedTrackIndex);
                loadTrack(globalIndex);
                currentView = 'playing';
            } else if (currentView === 'playing') {
                togglePlayPause();
            }
            renderScreen();
        }

        function togglePlayPause() {
            if (currentTrackIndex === -1) {
                const globalIndex = allTracks.findIndex(t => t.albumIndex === selectedAlbumIndex && t.originalTrackIndex === selectedTrackIndex);
                loadTrack(globalIndex);
                return;
            }
            if (activePlayerType === 'youtube' && !isYtReady) return;
            
            const shouldPlay = !isPlaying;
            if (activePlayerType === 'youtube') {
                shouldPlay ? ytPlayer.playVideo() : ytPlayer.pauseVideo();
            } else {
                setPlayState(shouldPlay);
            }
        }
        
        function playNext() {
            if (currentTrackIndex === -1) {
                loadTrack(0);
                return;
            }
            let nextIndex = currentTrackIndex + 1;
            if (nextIndex >= allTracks.length) nextIndex = 0;
            selectedTrackIndex = allTracks[nextIndex].originalTrackIndex;
            selectedAlbumIndex = allTracks[nextIndex].albumIndex;
            loadTrack(nextIndex);
        }

        function playPrev() {
            if (currentTrackIndex === -1) {
                loadTrack(0);
                return;
            }
            let prevIndex = currentTrackIndex - 1;
            if (prevIndex < 0) prevIndex = allTracks.length - 1;
            selectedTrackIndex = allTracks[prevIndex].originalTrackIndex;
            selectedAlbumIndex = allTracks[prevIndex].albumIndex;
            loadTrack(prevIndex);
        }

        function stopAllPlayers() {
            setPlayState(false);
            if (ytPlayer && typeof ytPlayer.stopVideo === 'function') ytPlayer.stopVideo();
            dom.audioPlayer.src = "";
            activePlayerType = null;
        }

        function renderScreen() {
            dom.albumView.classList.toggle('active', currentView === 'albums');
            dom.trackView.classList.toggle('active', currentView === 'tracks');
            dom.nowPlayingView.classList.toggle('active', currentView === 'playing');

            if (currentView === 'albums') {
                renderAlbumMenu();
            } else if (currentView === 'tracks') {
                renderTrackList();
            } else if (currentView === 'playing') {
                updatePlayerUI();
            }
        }

        function renderAlbumMenu() {
            dom.albumList.innerHTML = '';
            albums.forEach((album, index) => {
                const item = document.createElement('li');
                item.className = 'menu-item';
                item.textContent = album.title;
                if (index === selectedAlbumIndex) item.classList.add('active');
                dom.albumList.appendChild(item);
            });
        }

        function renderTrackList() {
            const album = albums[selectedAlbumIndex];
            dom.trackListHeader.textContent = album.title;
            dom.trackList.innerHTML = '';
            album.tracks.forEach((track, index) => {
                const item = document.createElement('li');
                item.className = 'menu-item';
                item.textContent = track.title;
                if (index === selectedTrackIndex) item.classList.add('active');
                
                const globalIndex = allTracks.findIndex(t => t.albumIndex === selectedAlbumIndex && t.originalTrackIndex === index);
                if (globalIndex === currentTrackIndex && isPlaying) item.classList.add('playing');

                dom.trackList.appendChild(item);
            });
        }
        
        function updatePlayerUI() {
            if (currentTrackIndex === -1) {
                dom.trackTitle.textContent = "Bem-vindo";
                dom.trackArtist.textContent = "Navegue com a roda";
                return;
            }
            const track = allTracks[currentTrackIndex];
            dom.trackTitle.textContent = track.title;
            dom.trackArtist.textContent = track.artist;
        }

        function updateProgress() {
            let currentTime = 0, duration = 0;
            if (activePlayerType === 'youtube' && ytPlayer && typeof ytPlayer.getDuration === 'function') {
                currentTime = ytPlayer.getCurrentTime();
                duration = ytPlayer.getDuration();
            } else if (activePlayerType === 'audio') {
                currentTime = dom.audioPlayer.currentTime;
                duration = dom.audioPlayer.duration;
            }
            if (isNaN(duration) || duration === 0) return;
            dom.timeDisplay.textContent = `${formatTime(currentTime)} / ${formatTime(duration)}`;
        }
        
        function formatTime(seconds) {
            const min = Math.floor(seconds / 60);
            const sec = Math.floor(seconds % 60);
            return `${String(min).padStart(2, '0')}:${String(sec).padStart(2, '0')}`;
        }
        
        function handleWheel(event) {
            let lastAngle = 0;
            const center = { x: event.currentTarget.getBoundingClientRect().left + 100, y: event.currentTarget.getBoundingClientRect().top + 100 };
            
            const onMove = (moveEvent) => {
                const clientX = moveEvent.touches ? moveEvent.touches[0].clientX : moveEvent.clientX;
                const clientY = moveEvent.touches ? moveEvent.touches[0].clientY : moveEvent.clientY;
                const angle = Math.atan2(clientY - center.y, clientX - center.x);
                if (lastAngle !== 0) {
                    const delta = angle - lastAngle;
                    if (Math.abs(delta) > 0.1) {
                         if (currentView === 'albums') {
                            if (delta > 0) selectedAlbumIndex = (selectedAlbumIndex + 1) % albums.length;
                            else selectedAlbumIndex = (selectedAlbumIndex - 1 + albums.length) % albums.length;
                         } else if (currentView === 'tracks') {
                            const trackCount = albums[selectedAlbumIndex].tracks.length;
                            if (delta > 0) selectedTrackIndex = (selectedTrackIndex + 1) % trackCount;
                            else selectedTrackIndex = (selectedTrackIndex - 1 + trackCount) % trackCount;
                         }
                         renderScreen();
                         lastAngle = angle;
                    }
                } else {
                    lastAngle = angle;
                }
            };
            const onEnd = () => {
                document.removeEventListener('mousemove', onMove);
                document.removeEventListener('mouseup', onEnd);
                document.removeEventListener('touchmove', onMove);
                document.removeEventListener('touchend', onEnd);
            };
            document.addEventListener('mousemove', onMove);
            document.addEventListener('mouseup', onEnd);
            document.addEventListener('touchmove', onMove);
            document.addEventListener('touchend', onEnd);
        }

        function initializePlayer() {
            flattenTracks();
            renderScreen();
            
            dom.playPauseBtn.addEventListener('click', handleCenterButtonClick);
            dom.clickWheel.addEventListener('mousedown', handleWheel);
            dom.clickWheel.addEventListener('touchstart', handleWheel);
            
            dom.nextBtn.addEventListener('click', playNext);
            dom.prevBtn.addEventListener('click', playPrev);
            dom.menuBtn.addEventListener('click', () => {
                if (currentView === 'tracks') currentView = 'albums';
                else if(currentView === 'playing') currentView = 'tracks';
                renderScreen();
            });
            
            dom.audioPlayer.addEventListener('ended', playNext);
            dom.audioPlayer.addEventListener('canplay', () => {
                if (activePlayerType === 'audio') setPlayState(true);
            });
        }

        document.addEventListener('DOMContentLoaded', initializePlayer);
    </script>
</body>
</html>
