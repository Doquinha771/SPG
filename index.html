<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SPG MP3 Player</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Pixelify+Sans:wght@400;700&family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-main: #1a1a1d;
            --mp3-body: #e1e1e1;
            --mp3-shadow: #c1c1c1;
            --screen-bg: #a8b8a0;
            --screen-border: #8c9c84;
            --screen-text: #2c3528;
            --wheel-color: #f0f0f0;
            --accent-playing: #2c3528;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            user-select: none;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-main);
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            overflow: hidden;
        }

        /* --- MP3 PLAYER BODY --- */
        .mp3-player {
            width: 320px;
            height: 550px;
            background: linear-gradient(145deg, #f0f0f0, #c8c8c8);
            border-radius: 40px;
            box-shadow: 20px 20px 60px #111, -20px -20px 60px #333;
            padding: 25px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
        }

        /* --- SCREEN --- */
        .screen-container {
            width: 100%;
            height: 180px;
            background: #444;
            border-radius: 10px;
            padding: 8px;
            box-shadow: inset 5px 5px 10px #3a3a3a, inset -5px -5px 10px #4e4e4e;
        }
        .screen {
            width: 100%;
            height: 100%;
            background: var(--screen-bg);
            border: 4px solid var(--screen-border);
            border-radius: 4px;
            padding: 10px;
            font-family: 'Pixelify Sans', sans-serif;
            color: var(--screen-text);
            overflow: hidden;
            position: relative;
        }
        .screen-header {
            text-align: center;
            font-weight: 700;
            margin-bottom: 5px;
            border-bottom: 2px solid var(--screen-text);
        }
        .playlist {
            list-style: none;
            height: calc(100% - 25px);
            overflow: hidden;
        }
        .playlist-item {
            padding: 2px 0;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .playlist-item.active {
            background-color: var(--screen-text);
            color: var(--screen-bg);
        }
        .playlist-item.playing::before {
            content: '‚ñ∫';
            margin-right: 5px;
        }

        /* --- CONTROLS --- */
        .controls-container {
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
        }
        #track-info-display {
            width: 100%;
            text-align: center;
            background: #ddd;
            padding: 5px;
            border-radius: 5px;
            box-shadow: inset 2px 2px 4px #bbb, inset -2px -2px 4px #fff;
        }
        #track-title { font-weight: 700; color: #333; }
        #track-artist { font-size: 0.8rem; color: #555; }
        #time-display { font-size: 0.8rem; color: #555; }

        .click-wheel {
            width: 200px;
            height: 200px;
            border-radius: 50%;
            background: linear-gradient(145deg, #f0f0f0, #cacaca);
            box-shadow: 10px 10px 20px #b9b9b9, -10px -10px 20px #ffffff;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
            cursor: pointer;
        }
        .center-button {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: linear-gradient(145deg, #cacaca, #f0f0f0);
            border: none;
            box-shadow: 5px 5px 10px #b9b9b9, -5px -5px 10px #ffffff;
            cursor: pointer;
        }
        .center-button:active {
            box-shadow: inset 5px 5px 10px #b9b9b9, inset -5px -5px 10px #ffffff;
        }
        .wheel-icon {
            position: absolute;
            color: #888;
            font-size: 0.8rem;
            font-weight: 600;
        }
        .wheel-icon.menu { top: 15px; }
        .wheel-icon.next { right: 15px; }
        .wheel-icon.prev { left: 15px; }
        .wheel-icon.play-pause-wheel { bottom: 15px; }
        
        /* --- Special Effects on Screen --- */
        .screen-effect {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none;
            opacity: 0;
        }
        .screen-effect.active {
            opacity: 1;
        }

        #blood-glitch {
            animation: blood-glitch-anim 0.5s steps(2, end) infinite;
        }
        @keyframes blood-glitch-anim {
            0% { background: transparent; }
            50% { background: rgba(255, 0, 0, 0.3); }
            100% { background: transparent; }
        }

        #bicho-glitch, #dove-glitch {
            overflow: hidden;
        }
        .pixel-sprite {
            position: absolute;
            font-size: 2rem;
            animation: scroll-across 10s linear infinite;
        }
        @keyframes scroll-across {
            from { transform: translateX(-100%); }
            to { transform: translateX(260px); }
        }
        #dove-glitch .pixel-sprite { animation-duration: 8s; }

        #youtube-player { position: absolute; top: -9999px; left: -9999px; }

    </style>
</head>
<body>
    <div class="mp3-player">
        <div class="screen-container">
            <div class="screen">
                <div class="screen-header">SPG Player</div>
                <ul class="playlist" id="playlist"></ul>

                <!-- Effects will be here -->
                <div id="blood-glitch" class="screen-effect"></div>
                <div id="bicho-glitch" class="screen-effect">
                    <span class="pixel-sprite" style="top: 20%; animation-delay: 0s;">üêò</span>
                    <span class="pixel-sprite" style="top: 50%; animation-delay: 2s;">üêì</span>
                    <span class="pixel-sprite" style="top: 30%; animation-delay: 5s;">üêÖ</span>
                </div>
                <div id="dove-glitch" class="screen-effect">
                     <span class="pixel-sprite" style="top: 40%;">üïäÔ∏è</span>
                </div>
            </div>
        </div>
        <div class="controls-container">
            <div id="track-info-display">
                <div id="track-title">Bem-vindo</div>
                <div id="track-artist">Selecione uma m√∫sica</div>
                <div id="time-display">0:00 / 0:00</div>
            </div>
            <div class="click-wheel" id="click-wheel">
                <div class="wheel-icon menu">MENU</div>
                <div class="wheel-icon next">‚ñ∫‚ñ∫</div>
                <div class="wheel-icon prev">‚óÑ‚óÑ</div>
                <div class="wheel-icon play-pause-wheel">‚ñ∫/‚ùö‚ùö</div>
                <button class="center-button" id="play-pause-btn"></button>
            </div>
        </div>
    </div>

    <audio id="audio-player" crossorigin="anonymous"></audio>
    <div id="youtube-player"></div>

    <script src="https://www.youtube.com/iframe_api"></script>
    <script>
        const albums = [
            {
                artist: "SPG",
                title: "O Segredo da Felicidade",
                tracks: [
                    { title: "Jogo do Bicho", youtubeId: "KNXJe2RxB_o", specialEffect: "bicho" },
                    { title: "Assassinatos", youtubeId: "sGWljyo4Zv0", specialEffect: "blood" },
                ]
            },
            {
                artist: "Artista Exemplo",
                title: "Exemplos de √Åudio",
                tracks: [
                    { title: "SoundHelix Song 1", url: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3" },
                    { title: "SoundHelix Song 2", url: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-2.mp3" },
                ]
            },
        ];

        const dom = {
            playlist: document.getElementById('playlist'),
            trackTitle: document.getElementById('track-title'),
            trackArtist: document.getElementById('track-artist'),
            timeDisplay: document.getElementById('time-display'),
            playPauseBtn: document.getElementById('play-pause-btn'),
            clickWheel: document.getElementById('click-wheel'),
            audioPlayer: document.getElementById('audio-player'),
            bloodGlitch: document.getElementById('blood-glitch'),
            bichoGlitch: document.getElementById('bicho-glitch'),
            doveGlitch: document.getElementById('dove-glitch'),
        };

        let ytPlayer;
        let isYtReady = false;
        let pendingTrack = null;
        let allTracks = [];
        let currentTrackIndex = -1;
        let selectedTrackIndex = 0;
        let isPlaying = false;
        let activePlayerType = null;
        let progressInterval;

        window.onYouTubeIframeAPIReady = () => {
            ytPlayer = new YT.Player('youtube-player', {
                height: '0', width: '0',
                playerVars: { 'controls': 0, 'disablekb': 1, 'playsinline': 1 },
                events: { 'onReady': onPlayerReady, 'onStateChange': onPlayerStateChange }
            });
        };
        
        function onPlayerReady() {
            isYtReady = true;
            if (pendingTrack) {
                loadTrack(pendingTrack);
                pendingTrack = null;
            }
        }

        function onPlayerStateChange(event) {
            if (event.data === YT.PlayerState.CUED) event.target.playVideo();
            if (event.data === YT.PlayerState.PLAYING) setPlayState(true);
            else if (event.data === YT.PlayerState.PAUSED || event.data === YT.PlayerState.ENDED) setPlayState(false);
            if (event.data === YT.PlayerState.ENDED) playNext();
        }

        function flattenTracks() {
            allTracks = albums.flatMap(album => 
                album.tracks.map(track => ({ ...track, artist: album.artist, albumTitle: album.title }))
            );
        }

        function loadTrack(trackIndex) {
            const track = allTracks[trackIndex];
            if (!track) return;
            
            if (track.youtubeId && !isYtReady) {
                console.warn("YouTube Player not ready yet, queuing track.");
                pendingTrack = trackIndex;
                dom.trackTitle.textContent = "Carregando...";
                return;
            }

            currentTrackIndex = trackIndex;
            
            stopAllPlayers();
            updatePlayerUI(track);

            if (track.youtubeId) {
                activePlayerType = 'youtube';
                ytPlayer.cueVideoById({ videoId: track.youtubeId });
            } else if (track.url) {
                activePlayerType = 'audio';
                dom.audioPlayer.src = track.url;
            }
        }

        function setPlayState(playing) {
            if (isPlaying === playing) return;
            isPlaying = playing;
            updateSpecialEffects(playing);
            renderPlaylist();
            if (playing) {
                if (activePlayerType === 'audio') dom.audioPlayer.play().catch(e => console.error(e));
                progressInterval = setInterval(updateProgress, 500);
            } else {
                if (activePlayerType === 'audio') dom.audioPlayer.pause();
                clearInterval(progressInterval);
            }
        }
        
        function updateSpecialEffects(playing) {
            dom.bloodGlitch.classList.remove('active');
            dom.bichoGlitch.classList.remove('active');
            dom.doveGlitch.classList.remove('active');

            if (playing && currentTrackIndex > -1) {
                const currentTrack = allTracks[currentTrackIndex];
                if (currentTrack.albumTitle === 'O Segredo da Felicidade') {
                    dom.doveGlitch.classList.add('active');
                }
                if (currentTrack.specialEffect === 'blood') {
                    dom.bloodGlitch.classList.add('active');
                }
                if (currentTrack.specialEffect === 'bicho') {
                    dom.bichoGlitch.classList.add('active');
                }
            }
        }

        function togglePlayPause() {
            if (currentTrackIndex === -1) {
                loadTrack(selectedTrackIndex);
                return;
            }
            if (currentTrackIndex !== selectedTrackIndex) {
                loadTrack(selectedTrackIndex);
                return;
            }
            if (activePlayerType === 'youtube' && !isYtReady) return;
            
            const shouldPlay = !isPlaying;
            if (activePlayerType === 'youtube') {
                shouldPlay ? ytPlayer.playVideo() : ytPlayer.pauseVideo();
            } else {
                setPlayState(shouldPlay);
            }
        }
        
        function playNext() {
            let nextIndex = currentTrackIndex + 1;
            if (nextIndex >= allTracks.length) nextIndex = 0;
            selectedTrackIndex = nextIndex;
            loadTrack(nextIndex);
        }

        function playPrev() {
            let prevIndex = currentTrackIndex - 1;
            if (prevIndex < 0) prevIndex = allTracks.length - 1;
            selectedTrackIndex = prevIndex;
            loadTrack(prevIndex);
        }

        function stopAllPlayers() {
            setPlayState(false);
            if (ytPlayer && typeof ytPlayer.stopVideo === 'function') ytPlayer.stopVideo();
            dom.audioPlayer.src = "";
            activePlayerType = null;
        }

        function renderPlaylist() {
            dom.playlist.innerHTML = '';
            const start = Math.max(0, selectedTrackIndex - 3);
            const end = Math.min(allTracks.length, start + 7);

            for (let i = start; i < end; i++) {
                const track = allTracks[i];
                const item = document.createElement('li');
                item.className = 'playlist-item';
                item.textContent = track.title;
                if (i === selectedTrackIndex) item.classList.add('active');
                if (i === currentTrackIndex && isPlaying) item.classList.add('playing');
                dom.playlist.appendChild(item);
            }
        }
        
        function updatePlayerUI(track) {
            dom.trackTitle.textContent = track.title;
            dom.trackArtist.textContent = track.artist;
            renderPlaylist();
        }

        function updateProgress() {
            let currentTime = 0, duration = 0;
            if (activePlayerType === 'youtube' && ytPlayer && typeof ytPlayer.getDuration === 'function') {
                currentTime = ytPlayer.getCurrentTime();
                duration = ytPlayer.getDuration();
            } else if (activePlayerType === 'audio') {
                currentTime = dom.audioPlayer.currentTime;
                duration = dom.audioPlayer.duration;
            }
            if (isNaN(duration) || duration === 0) return;
            dom.timeDisplay.textContent = `${formatTime(currentTime)} / ${formatTime(duration)}`;
        }
        
        function formatTime(seconds) {
            const min = Math.floor(seconds / 60);
            const sec = Math.floor(seconds % 60);
            return `${String(min).padStart(2, '0')}:${String(sec).padStart(2, '0')}`;
        }
        
        function handleWheel(event) {
            let lastAngle = 0;
            const center = { x: event.currentTarget.offsetLeft + 100, y: event.currentTarget.offsetTop + 100 };
            
            const onMouseMove = (moveEvent) => {
                const angle = Math.atan2(moveEvent.clientY - center.y, moveEvent.clientX - center.x);
                if (lastAngle !== 0) {
                    const delta = angle - lastAngle;
                    if (Math.abs(delta) > 0.05) { // Threshold to detect change
                         if (delta > 0 && selectedTrackIndex < allTracks.length - 1) {
                            selectedTrackIndex++;
                         } else if (delta < 0 && selectedTrackIndex > 0) {
                            selectedTrackIndex--;
                         }
                         renderPlaylist();
                    }
                }
                lastAngle = angle;
            };
            const onMouseUp = () => {
                document.removeEventListener('mousemove', onMouseMove);
                document.removeEventListener('mouseup', onMouseUp);
            };
            document.addEventListener('mousemove', onMouseMove);
            document.addEventListener('mouseup', onMouseUp);
        }

        function initializePlayer() {
            flattenTracks();
            renderPlaylist();
            
            dom.playPauseBtn.addEventListener('click', togglePlayPause);
            dom.clickWheel.addEventListener('mousedown', handleWheel);
            // Quick navigation with side icons for accessibility
            document.querySelector('.wheel-icon.next').addEventListener('click', playNext);
            document.querySelector('.wheel-icon.prev').addEventListener('click', playPrev);
            
            dom.audioPlayer.addEventListener('ended', playNext);
            dom.audioPlayer.addEventListener('canplay', () => {
                if (activePlayerType === 'audio') setPlayState(true);
            });
        }

        document.addEventListener('DOMContentLoaded', initializePlayer);
    </script>
</body>
</html>
